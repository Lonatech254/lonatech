<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Categories | LonaTech</title>
    <meta name="description" content="Explore our categories and services at LonaTech.">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
        }
            a {
            text-decoration: none;
            color: #000;
        }
        .navbar-brand img{
            height: 40px;
        }
        .bg_accent {
            background: #1f2937;
        }
        .text_accent {
            color: #1f2937;
        }
        .bg_primary {
            background: #00bfa6;
        }
        .btn_primary {
            background: #00bfa6;
        }

        .btn_outline-primary {
            border: 1px solid #00bfa6;
        }
        .text_primary {
            color: #00bfa6;
        }
        .category-card {
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            margin-bottom: 2rem;
            background: #fff;
            transition: box-shadow .2s;
        }
        .category-card:hover {
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
        }
        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 2rem 1rem 2rem;
            border-bottom: 1px solid #f1f1f1;
            background: linear-gradient(90deg, #a7fff3 0%, #f8f9fa 100%);
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
        }
        .category-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #00bfa6;
            margin-bottom: 0;
        }
        .category-description {
            color: #495057;
            font-size: 1.1rem;
            margin: 1rem;
        }
        .see-more-btn {
            white-space: nowrap;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 2rem;
            padding: 0.5rem 1.5rem;
            transition: background .2s, color .2s;
        }
        .see-more-btn:hover {
            background: #00bfa6;
            color: #fff;
        }
        .service-list {
            padding: 1.5rem 2rem 2rem 2rem;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .service-card {
            flex: 1 1 200px;
            border: 1px solid #e9ecef;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            background: #f9fafb;
            transition: box-shadow .2s;
            box-shadow: 0 1px 4px rgba(0,0,0,0.03);
            padding-bottom: 10px;
        }
        .service-card:hover {
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
        }
        .service-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem 0.5rem 1.5rem;
        }
        .service-title {
            font-size: 1.15rem;
            font-weight: 500;
            color: #212529;
            margin-bottom: 0;
        }

        .service-description {
            color: #495057;
            font-size: 1rem;
            padding: 0 1.5rem 1rem 1.5rem;
        }
        @media (max-width: 767px) {
            .category-header, .category-description, .service-list {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            .category-header, .service-description {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .category-title {
                font-size: 17px;
            }
            .service-list {
        }
            .see-more-btn {
                font-size: 12px;
                padding: 5px;
            }
        }
        .service-list {
            scrollbar-width: thin;
            scrollbar-color: #00bfa6 #f1f1f1;
        }
        .service-list::-webkit-scrollbar {
            height: 8px;
            background: #f1f1f1;
        }
        .service-list::-webkit-scrollbar-thumb {
            background: #00bfa6;
            border-radius: 4px;
        }
        .divider {
            border-top: 2px dashed #e3e3e3;
            margin: 2rem 0;
        }        
        .service-price {
            font-size: 1.1rem;
            font-weight: 600;
            color: #198754;
            padding: 0 1.5rem 1rem 1.5rem;
        }

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
        <div class="container">
         <a class="navbar-brand" href="/"><img src="/logo" alt=""></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    &nbsp;
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/blog">Blog</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/categories">Services</a></li>
                    <li class="nav-item"><a class="nav-link" href="/#contact">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>
                    <nav aria-label="breadcrumb m-2">
                    <ol class="breadcrumb container">
                        <li class="breadcrumb-item"><a class="text_primary" href="/">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Categories</li>
                    </ol>
                </nav>
    <header class="container mb-5">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-5 fw-bold text_primary mb-3">Services</h1>
            </div>
        </div>
    </header>
    <main id="categories-container">
        <!-- Categories will be injected here -->
        <div class="text-center my-5">
            <div class="spinner-border text_primary" role="status" id="loading-spinner">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </main>
    <footer class="bg-white border-top mt-5 py-4">
        <div class="container text-center">
            <div class="mb-2">
                <a href="/" class="text-decoration-none text_primary fw-bold">LonaTech</a>
            </div>
            <div class="text-muted small">
                &copy; <span id="year"></span> LonaTech. All rights reserved.
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        function formatPrice(price, unit) {
            return new Intl.NumberFormat('en-KE', { style: 'currency', currency: unit }).format(price);
        }

        function escapeHTML(str) {
            return String(str).replace(/[&<>"']/g, function(m) {
                return ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                })[m];
            });
        }

        async function loadCategories() {
            const container = document.getElementById('categories-container');
            try {
                const res = await fetch('/api/categories');
                if (!res.ok) throw new Error('Failed to fetch categories');
                const categories = await res.json();
                if (!Array.isArray(categories) || categories.length === 0) {
                    container.innerHTML = '<div class="alert alert-warning text-center">No categories found.</div>';
                    return;
                }
                let html = '';
                categories.sort((a, b) => a.order - b.order);
                categories.forEach(category => {

                    html += `
                        <section class="category-card">
                            <div class="category-header">
                                <h2 class="category-title mb-0">${escapeHTML(category.name)}</h2>
                                <a href="/category?id=${category.id}" class="btn btn_outline-primary see-more-btn">
                                    See more
                                </a>
                            </div>
                            <div class="category-description">${escapeHTML(category.description)}</div>
                            <div class="service-list">
                                ${category.services && category.services.length > 0
                                    ? category.services
                                            .sort((a, b) => a.order - b.order)
                                            .map(service => `
                                            
                                                <div class="service-card">
                                                    <a href="/service?id=${service.id}">
                                                    <div class="service-header">
                                                        <span class="service-title">${escapeHTML(service.name)}</span>
                                                    </div>
                                                    <div class="service-description">${escapeHTML(service.description)}</div>
                                                    <span class="service-price">${service.price} ${service.priceUnit}</span>
                                                </a></div>
                                            `).join('')
                                    : `<div class="alert alert-info mb-0">No services available in this category yet.</div>`
                                }
                            </div>
                        </section>
                        <div class="divider"></div>
                    `;
                });
                container.innerHTML = html;
            } catch (err) {
                
                console.log(err);
                container.innerHTML = `<div class="alert alert-danger text-center">Error loading categories. Please try again later.</div>`;
            } finally {
                document.getElementById('loading-spinner')?.remove();
            }
        }

        (function injectBootstrapIcons() {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css';
            document.head.appendChild(link);
        })();

        window.addEventListener('DOMContentLoaded', loadCategories);
    </script>

</body>
</html>